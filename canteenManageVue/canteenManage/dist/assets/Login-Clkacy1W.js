/* empty css                *//* empty css               *//* empty css                *//* empty css                  *//* empty css               *//* empty css            *//* empty css               *//* empty css                  *//* empty css              */import{_ as M,o as k,c as F,r as w,s as x,a,b as t,w as r,L as R,C as S,u as C,a7 as T,a8 as z,g,E as p,h as q,y as I,J as B,Q as D,M as $,z as A}from"./index-CnZojLtj.js";import{r as y}from"./request-D4_zAD7W.js";const P={name:"validCode",data(){return{codes:[],ctx:"",colors:["red","yellow","blue","green","pink","black"],code_Len:4}},mounted(){this.draw()},computed:{codeString(){let i="";for(let l=0;l<this.codes.length;l++)i+=this.codes[l];return i.toUpperCase()}},watch:{codeString:function(i){this.$emit("change",i)}},methods:{generateRandom(){this.codes=[];const l="abcdefghijkmnpqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ23456789".split("");for(let o=0;o<this.code_Len;o++){const d=Math.floor(Math.random()*l.length);this.codes.push(l[d])}},draw(){this.generateRandom(),this.drawText()},drawLine(){for(let d=0;d<3;d++)this.ctx.strokeStyle=this.colors[Math.floor(Math.random()*5)],this.ctx.beginPath(),this.ctx.moveTo(Math.floor(Math.random()*140),Math.floor(Math.random()*30)),this.ctx.lineTo(Math.floor(Math.random()*140),Math.floor(Math.random()*30)),this.ctx.stroke()},drawText(){const i=this.$refs.canvas;this.ctx=i.getContext("2d"),this.ctx.fillStyle="#BFEFFF",this.ctx.fillRect(0,0,140,40),this.ctx.font="20px Verdana";let l=15;for(let o=0;o<this.code_Len;o++)this.ctx.fillStyle=this.colors[Math.floor(Math.random()*5)],this.ctx.fillText(this.codes[o],l,25),l=l+30;this.drawLine()}}};function X(i,l,o,d,h,f){return k(),F("canvas",{ref:"canvas",onClick:l[0]||(l[0]=(..._)=>f.draw&&f.draw(..._)),width:"140",height:"40",style:{cursor:"pointer"}},null,512)}const Y=M(P,[["render",X]]),J={class:"login-container"},j={class:"login-box"},O={class:"valid-code"},Q={class:"valid-code-img"},G={class:"reset-dialog"},H={class:"centered-dialog"},K={class:"dialog-footer"},W={__name:"Login",setup(i){const l=w({data:{username:"",phone:"",role:""},resetRules:{username:[{required:!0,message:"请输入账号",trigger:"blur"}],phone:[{required:!0,message:"请输入电话",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"blur"}]}}),o=w({form:{username:"",password:"",role:"",validCode:""},rules:{username:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码不能少于六位",trigger:"blur"}],validCode:[{required:!0,message:"请输入验证码",trigger:"blur"}]}}),d=x(""),h=x(),f=x(),_=m=>{d.value=m.toLowerCase()},E=()=>{h.value.validate(m=>{if(o.form.validCode.toLowerCase()!==d.value){p.error("验证码错误");return}m&&y.post("/login",o.form).then(n=>{n.code==="200"?(p.success("登录成功"),localStorage.setItem("project-user",JSON.stringify(n.data)),q.push("/")):p.error("登录信息输入错误，登录失败")})})},U=()=>{l.data={},o.formVisible=!0},L=()=>{f.value.validate(m=>{m&&y.put("/resetPassword",l.data).then(e=>{e.code==="200"?(p.success("密码重置成功"),o.formVisible=!1):p.error(e.msg)})})};return(m,e)=>{const n=I,u=B,c=D,V=$,v=A,b=R,N=S;return k(),F("div",J,[a("div",j,[e[13]||(e[13]=a("div",{class:"login-title",style:{"font-size":"30px","font-weight":"bold","margin-bottom":"10px",color:"#F0FFFF"}},"欢 迎 登 录 ",-1)),t(b,{ref_key:"formRef",ref:h,model:o.form,rules:o.rules},{default:r(()=>[t(u,{prop:"username"},{default:r(()=>[t(n,{"prefix-icon":C(T),modelValue:o.form.username,"onUpdate:modelValue":e[0]||(e[0]=s=>o.form.username=s),size:"large",placeholder:"请输入账号"},null,8,["prefix-icon","modelValue"])]),_:1}),t(u,{prop:"password"},{default:r(()=>[t(n,{"show-password":"","prefix-icon":C(z),modelValue:o.form.password,"onUpdate:modelValue":e[1]||(e[1]=s=>o.form.password=s),size:"large",placeholder:"请输入密码"},null,8,["prefix-icon","modelValue"])]),_:1}),t(u,{prop:"role"},{default:r(()=>[t(V,{size:"large",modelValue:o.form.role,"onUpdate:modelValue":e[2]||(e[2]=s=>o.form.role=s)},{default:r(()=>[t(c,{label:"管理员",value:"ADMIN"}),t(c,{label:"学生",value:"STUDENT"})]),_:1},8,["modelValue"])]),_:1}),t(u,{prop:"validCode"},{default:r(()=>[a("div",O,[t(n,{"prefix-icon":"Check",size:"medium",placeholder:"请输入验证码",modelValue:o.form.validCode,"onUpdate:modelValue":e[3]||(e[3]=s=>o.form.validCode=s)},null,8,["modelValue"]),a("div",Q,[t(Y,{onChange:_})])])]),_:1}),t(u,null,{default:r(()=>[t(v,{type:"info",size:"large",onClick:E},{default:r(()=>e[9]||(e[9]=[g("登 录")])),_:1})]),_:1}),a("div",{style:{display:"flex"}},[a("div",{style:{flex:"1","margin-bottom":"10px"}},[a("a",{style:{color:"#551A8B",cursor:"pointer"},onClick:U},"忘记密码？")]),e[10]||(e[10]=a("div",{style:{flex:"1","text-align":"right","margin-bottom":"10px"}},[g(" 还没有账号？"),a("a",{href:"/register"},"立即注册")],-1))])]),_:1},8,["model","rules"]),a("div",G,[t(N,{title:"忘记密码",modelValue:o.formVisible,"onUpdate:modelValue":e[8]||(e[8]=s=>o.formVisible=s),width:"35%"},{footer:r(()=>[a("div",K,[t(v,{onClick:e[7]||(e[7]=s=>o.formVisible=!1)},{default:r(()=>e[11]||(e[11]=[g("取消")])),_:1}),t(v,{type:"primary",onClick:L},{default:r(()=>e[12]||(e[12]=[g("确定")])),_:1})])]),default:r(()=>[a("div",H,[t(b,{ref_key:"resetFormRef",ref:f,rules:l.resetRules,model:l.data,"label-width":"60px"},{default:r(()=>[t(u,{prop:"username",label:"账号"},{default:r(()=>[t(n,{modelValue:l.data.username,"onUpdate:modelValue":e[4]||(e[4]=s=>l.data.username=s),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),t(u,{prop:"phone",label:"电话"},{default:r(()=>[t(n,{modelValue:l.data.phone,"onUpdate:modelValue":e[5]||(e[5]=s=>l.data.phone=s),placeholder:"请输入电话"},null,8,["modelValue"])]),_:1}),t(u,{prop:"role",label:"角色"},{default:r(()=>[t(V,{size:"large",modelValue:l.data.role,"onUpdate:modelValue":e[6]||(e[6]=s=>l.data.role=s)},{default:r(()=>[t(c,{label:"管理员",value:"ADMIN"}),t(c,{label:"学生",value:"STUDENT"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])])]),_:1},8,["modelValue"])])])])}}},ue=M(W,[["__scopeId","data-v-8ced0f78"]]);export{ue as default};
