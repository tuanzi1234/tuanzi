/* empty css                *//* empty css                  *//* empty css             *//* empty css                     *//* empty css               *//* empty css                *//* empty css                     *//* empty css                   *//* empty css            *//* empty css               *//* empty css                  *//* empty css                    *//* empty css                *//* empty css               *//* empty css              */import{r as c}from"./request-6eHoymb-.js";import{r as F,c as V,a as d,b as r,w as l,v as m,E as f,y as M,z as q,A as G,B as H,C as L,o as n,g as s,P as y,t as u,u as N,D as E,x as K,H as Q,R as W,k as X,I as Y,S as Z,T as ee,$ as te,J as oe,L as le}from"./index-C86Pu7Zh.js";const re={style:{width:"70%",margin:"20px auto"}},ae={class:"card"},se={class:"card",style:{margin:"10px auto"}},ie={style:{color:"red"}},de={key:3},ne={key:0,class:"card"},pe=["href"],me={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},ue={style:{color:"red","font-weight":"bold"}},fe=["href"],ye={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},_e={style:{color:"red","font-weight":"bold"}},ge={style:{"margin-top":"20px",display:"flex","align-items":"center"}},ce={style:{"margin-top":"40px",display:"flex","align-items":"center","grid-gap":"20px"}},we={style:{flex:"1","text-align":"right","font-size":"15px",color:"red"}},be={style:{"font-size":"25px"}},he={style:{width:"100px"}},xe={class:"dialog-footer"},Re={__name:"Orders",setup(Ve){const o=F({user:JSON.parse(localStorage.getItem("project-user")||"{}"),oderNo:null,pageNum:1,pageSize:5,total:0,ordersData:[],ordersItemData:[],status:null,itemVisible:!1,payVisible:!1,totalPrice:0,orders:{},commentVisible:!1,ordersItem:{}}),g=()=>{c.get("/orders/selectPage",{params:{pageNum:o.pageNum,pageSize:o.pageSize,studentId:o.user.id}}).then(a=>{a.code=="200"?(o.ordersData=a.data.list,o.total=a.data.total):f.error(a.msg)})};g();const S=()=>{o.oderNo=null,g()},D=(a,t)=>{c.get("/ordersItem/selectAll",{params:{orderId:a}}).then(p=>{p.code=="200"?(o.ordersItemData=p.data,o.status=t,o.itemVisible=!0):f.error(p.msg)})},T=a=>{c.get("/ordersItem/selectAll",{params:{orderId:a}}).then(t=>{t.code=="200"?(o.ordersItemData=t.data,o.payVisible=!0):f.error(t.msg)})},z=a=>{K.confirm("取消后需要重新点单，是否取消？","取消确认",{type:"warning"}).then(t=>{c.delete(`/orders/delete/${a.id}`).then(p=>{p.code==="200"?(f.success("取消成功"),g()):f.error(p.msg)}).catch(p=>{f.error(p)})})},B=a=>{o.orders=a,T(a.id)},U=()=>{if(!o.orders.payType){f.warning("请选择支付方式");return}c.post("/orders/pay",o.orders).then(a=>{a.code=="200"?(localStorage.setItem("project-user",JSON.stringify(a.data)),f.success("支付成功"),o.payVisible=!1,g()):f.error(a.msg)})},$=(a,t)=>{o.form=JSON.parse(JSON.stringify(a)),o.form.status=t,c.put("/orders/update",o.form).then(p=>{p.code==="200"?(f.success("更新成功"),g(),o.formVisible=!1):f.error(p.msg)})},J=a=>{o.ordersItem=JSON.parse(JSON.stringify(a)),o.commentVisible=!0},O=()=>{c.put("/ordersItem/update",o.ordersItem).then(a=>{a.code==="200"?(f.success("评价成功"),o.commentVisible=!1,o.itemVisible=!1):f.error(a.msg)})};return(a,t)=>{const p=M,_=q,i=Q,w=W,h=G,j=H,v=X,k=Y,x=L,I=Z,P=ee,R=te,C=oe,A=le;return n(),V("div",re,[d("div",ae,[r(p,{modelValue:o.oderNo,"onUpdate:modelValue":t[0]||(t[0]=e=>o.oderNo=e),"prefix-icon":"Search",style:{width:"240px","margin-right":"10px"},placeholder:"请输入订单编号"},null,8,["modelValue"]),r(_,{type:"info",plain:"",onClick:g},{default:l(()=>t[9]||(t[9]=[s("查询")])),_:1}),r(_,{type:"info",style:{margin:"0 10px"},plain:"",onClick:S},{default:l(()=>t[10]||(t[10]=[s("重置")])),_:1})]),d("div",se,[r(h,{stripe:"",data:o.ordersData,border:"",style:{width:"100%"}},{default:l(()=>[r(i,{prop:"orderNo",label:"订单号",width:"160px"}),r(i,{prop:"createTime",label:"下单时间",width:"180px"}),r(i,{prop:"payNo",label:"支付单号","show-overflow-tooltip":""}),r(i,{prop:"payType",label:"支付方式"},{default:l(e=>[e.row.payType==="支付宝"?(n(),y(w,{key:0,type:"info"},{default:l(()=>[s(u(e.row.payType),1)]),_:2},1024)):m("",!0),e.row.payType==="微信"?(n(),y(w,{key:1,type:"success"},{default:l(()=>[s(u(e.row.payType),1)]),_:2},1024)):m("",!0)]),_:1}),r(i,{prop:"price",label:"订单价格"},{default:l(e=>[d("span",ie,"￥"+u(e.row.price),1)]),_:1}),r(i,{prop:"status",label:"订单状态"},{default:l(e=>[e.row.status==="待支付"?(n(),y(w,{key:0,type:"warning"},{default:l(()=>[s(u(e.row.status),1)]),_:2},1024)):m("",!0),e.row.status==="已支付"?(n(),y(w,{key:1,type:"info"},{default:l(()=>[s(u(e.row.status),1)]),_:2},1024)):m("",!0),e.row.status==="已上餐"?(n(),y(w,{key:2,type:"primary"},{default:l(()=>[s(u(e.row.status),1)]),_:2},1024)):m("",!0),e.row.status==="已完成"?(n(),y(w,{key:3,type:"success"},{default:l(()=>[s(u(e.row.status),1)]),_:2},1024)):m("",!0)]),_:1}),r(i,{label:"订单详情",width:"130px"},{default:l(e=>[r(_,{type:"primary",plain:"",onClick:b=>D(e.row.id,e.row.status)},{default:l(()=>t[11]||(t[11]=[s("查看详情")])),_:2},1032,["onClick"])]),_:1}),r(i,{label:"操作",width:"200px"},{default:l(e=>[e.row.status==="待支付"?(n(),y(_,{key:0,type:"danger",plain:"",onClick:b=>z(e.row)},{default:l(()=>t[12]||(t[12]=[s("取消订单")])),_:2},1032,["onClick"])):m("",!0),e.row.status==="待支付"?(n(),y(_,{key:1,type:"info",plain:"",onClick:b=>B(e.row)},{default:l(()=>t[13]||(t[13]=[s("支付")])),_:2},1032,["onClick"])):m("",!0),e.row.status==="已上餐"?(n(),y(_,{key:2,type:"success",plain:"",onClick:b=>$(e.row,"已完成")},{default:l(()=>t[14]||(t[14]=[s("完成")])),_:2},1032,["onClick"])):m("",!0),e.row.status==="已支付"?(n(),V("span",de,"出餐中......")):m("",!0)]),_:1})]),_:1},8,["data"])]),o.total?(n(),V("div",ne,[r(j,{onCurrentChange:g,background:"",layout:"total, prev, pager, next","page-size":o.pageSize,"current-page":o.pageNum,"onUpdate:currentPage":t[1]||(t[1]=e=>o.pageNum=e),total:o.total},null,8,["page-size","current-page","total"])])):m("",!0),r(x,{title:"订单详情",modelValue:o.itemVisible,"onUpdate:modelValue":t[2]||(t[2]=e=>o.itemVisible=e),width:"60%"},{default:l(()=>[r(h,{stripe:"",data:o.ordersItemData,border:"",style:{width:"100%"}},{default:l(()=>[r(i,{prop:"dish.name",label:"菜品名称"},{default:l(e=>[d("a",{href:"/front/dishDetail?id="+e.row.dishId},u(e.row.dish.name),9,pe)]),_:1}),r(i,{prop:"dish.img",label:"菜品图片",width:"90px"},{default:l(e=>[e.row.dish.img?(n(),y(k,{key:0,src:e.row.dish.img,"preview-src-list":[e.row.dish.img],fit:"cover",style:{width:"50px",height:"50px","object-fit":"cover"},"preview-teleported":""},{error:l(()=>[d("div",me,[r(v,null,{default:l(()=>[r(N(E))]),_:1})])]),_:2},1032,["src","preview-src-list"])):m("",!0)]),_:1}),r(i,{prop:"dish.price",label:"菜品价格"},{default:l(e=>[d("span",ue,"￥ "+u(e.row.dish.price),1)]),_:1}),r(i,{prop:"num",label:"菜品份数"},{default:l(e=>[s(" x"+u(e.row.num),1)]),_:1}),o.status=="已完成"?(n(),y(i,{key:0,label:"操作",width:"180"},{default:l(e=>[r(_,{type:"success",disabled:e.row.comment||e.row.score,plain:"",onClick:b=>J(e.row)},{default:l(()=>t[15]||(t[15]=[s("评价")])),_:2},1032,["disabled","onClick"])]),_:1})):m("",!0)]),_:1},8,["data"])]),_:1},8,["modelValue"]),r(x,{title:"支付详情",modelValue:o.payVisible,"onUpdate:modelValue":t[4]||(t[4]=e=>o.payVisible=e),width:"30%"},{default:l(()=>[r(h,{stripe:"",data:o.ordersItemData,border:"",style:{width:"100%"}},{default:l(()=>[r(i,{prop:"dish.name",label:"菜品名称"},{default:l(e=>[d("a",{href:"/front/dishDetail?id="+e.row.dishId},u(e.row.dish.name),9,fe)]),_:1}),r(i,{prop:"dish.img",label:"菜品图片",width:"90px"},{default:l(e=>[e.row.dish.img?(n(),y(k,{key:0,src:e.row.dish.img,"preview-src-list":[e.row.dish.img],fit:"cover",style:{width:"50px",height:"50px","object-fit":"cover"},"preview-teleported":""},{error:l(()=>[d("div",ye,[r(v,null,{default:l(()=>[r(N(E))]),_:1})])]),_:2},1032,["src","preview-src-list"])):m("",!0)]),_:1}),r(i,{prop:"dish.price",label:"菜品价格"},{default:l(e=>[d("span",_e,"￥ "+u(e.row.dish.price),1)]),_:1}),r(i,{prop:"num",label:"菜品份数"},{default:l(e=>[s(" x"+u(e.row.num),1)]),_:1})]),_:1},8,["data"]),d("div",ge,[t[16]||(t[16]=d("div",{style:{"font-size":"15px"}},"支付方式：",-1)),r(P,{modelValue:o.orders.payType,"onUpdate:modelValue":t[3]||(t[3]=e=>o.orders.payType=e)},{default:l(()=>[r(I,{label:"支付宝",value:"支付宝"}),r(I,{label:"微信",value:"微信"})]),_:1},8,["modelValue"]),t[17]||(t[17]=d("div",{style:{"margin-left":"5px"}}," 支付功能需要营业执照,故此处仅作演示 ",-1))]),d("div",ce,[d("div",we,[t[18]||(t[18]=s("支付金额：")),d("span",be,"￥"+u(o.orders.price),1)]),d("div",he,[r(_,{onClick:U,type:"danger",style:{width:"100px"}},{default:l(()=>t[19]||(t[19]=[s("确认支付")])),_:1})])])]),_:1},8,["modelValue"]),r(x,{title:"评价信息",modelValue:o.commentVisible,"onUpdate:modelValue":t[8]||(t[8]=e=>o.commentVisible=e),width:"30%"},{footer:l(()=>[d("div",xe,[r(_,{onClick:t[7]||(t[7]=e=>o.commentVisible=!1)},{default:l(()=>t[20]||(t[20]=[s("取消")])),_:1}),r(_,{type:"primary",onClick:O},{default:l(()=>t[21]||(t[21]=[s(" 确定 ")])),_:1})])]),default:l(()=>[r(A,{ref:"formRef",model:o.ordersItem,"label-width":"80px",style:{padding:"20px"}},{default:l(()=>[r(C,{prop:"score",label:"菜品评分"},{default:l(()=>[r(R,{modelValue:o.ordersItem.score,"onUpdate:modelValue":t[5]||(t[5]=e=>o.ordersItem.score=e),"show-score":"","text-color":"#ff9900","score-template":"{value} 分"},null,8,["modelValue"])]),_:1}),r(C,{prop:"comment",label:"评价内容"},{default:l(()=>[r(p,{type:"textarea",rows:"4",modelValue:o.ordersItem.comment,"onUpdate:modelValue":t[6]||(t[6]=e=>o.ordersItem.comment=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{Re as default};
