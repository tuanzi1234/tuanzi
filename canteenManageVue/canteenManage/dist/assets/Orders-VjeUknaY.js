/* empty css                *//* empty css               *//* empty css                *//* empty css                     *//* empty css                   *//* empty css            *//* empty css               *//* empty css                  *//* empty css                    *//* empty css                *//* empty css               *//* empty css              */import{r as w}from"./request-cmqZYDHD.js";import{r as P,c as N,a as y,b as r,w as o,v as u,E as d,x as k,y as U,z as $,A as q,B as O,C as j,o as p,g as n,P as c,t as m,u as A,D as J,H as M,R as H,k as R,I as F}from"./index-SmzkdM8_.js";const G={class:"card"},K={class:"card",style:{"margin-bottom":"10px"}},L={class:"card",style:{"margin-bottom":"10px"}},Q={style:{color:"red"}},W={key:0,class:"card"},X={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",height:"100%"}},Y={style:{color:"red","font-weight":"bold"}},ge={__name:"Orders",setup(Z){const a=P({formVisible:!1,form:{},tableData:[],pageNum:1,pageSize:5,total:0,orderNo:null,studentName:null,ids:[],ordersItemData:[],status:null,itemVisible:!1,rules:{title:[{required:!0,message:"请输入订单标题",trigger:"blur"}],content:[{required:!0,message:"请输入订单内容",trigger:"blur"}]}}),x=l=>{a.ids=l.map(t=>t.id)},g=()=>{w.get("/orders/selectPage",{params:{pageNum:a.pageNum,pageSize:a.pageSize,orderNo:a.orderNo,studentName:a.studentName}}).then(l=>{var t,s;l.code==="200"?(a.tableData=((t=l.data)==null?void 0:t.list)||[],a.total=(s=l.data)==null?void 0:s.total):d.error(l.msg)})};g();const V=l=>{k.confirm("是否删除该订单信息?（删除后将无法恢复）","删除确认",{type:"warning"}).then(t=>{w.delete(`/orders/delete/${l.id}`).then(s=>{s.code==="200"?(d.success("删除成功"),g()):d.error(s.msg)}).catch(s=>{d.error(s)})})},v=()=>{if(!a.ids.length){d.warning("请选择要删除的订单信息");return}k.confirm("是否删除该订单信息?（删除后将无法恢复）","删除确认",{type:"warning"}).then(l=>{w.delete("/orders/delete/batch",{data:a.ids}).then(t=>{t.code==="200"?(d.success("删除成功"),g()):d.error(t.msg)}).catch(t=>{d.error(t)})})},C=()=>{a.orderNo=null,a.studentName=null,g()},E=(l,t)=>{w.get("/ordersItem/selectAll",{params:{orderId:l}}).then(s=>{s.code=="200"?(a.ordersItemData=s.data,a.status=t,a.itemVisible=!0):d.error(s.msg)})},S=()=>{w.put("/orders/update",a.form).then(l=>{l.code==="200"?(d.success("更新成功"),g(),a.formVisible=!1):d.error(l.msg)})},D=(l,t)=>{a.form=JSON.parse(JSON.stringify(l)),a.form.status=t,S()};return(l,t)=>{const s=U,f=$,i=M,_=H,b=q,T=O,I=R,B=F,z=j;return p(),N("div",null,[y("div",G,[r(s,{modelValue:a.orderNo,"onUpdate:modelValue":t[0]||(t[0]=e=>a.orderNo=e),"prefix-icon":"Search",style:{width:"240px","margin-right":"10px"},placeholder:"请输入订单编号"},null,8,["modelValue"]),r(s,{modelValue:a.studentName,"onUpdate:modelValue":t[1]||(t[1]=e=>a.studentName=e),"prefix-icon":"Search",style:{width:"240px","margin-right":"10px"},placeholder:"请输入学生姓名"},null,8,["modelValue"]),r(f,{type:"info",plain:"",onClick:g},{default:o(()=>t[4]||(t[4]=[n("查询")])),_:1}),r(f,{type:"info",style:{margin:"0 10px"},plain:"",onClick:C},{default:o(()=>t[5]||(t[5]=[n("重置")])),_:1})]),y("div",K,[r(f,{type:"danger",plain:"",onClick:v},{default:o(()=>t[6]||(t[6]=[n("批量删除")])),_:1})]),y("div",L,[r(b,{stripe:"",data:a.tableData,border:"",style:{width:"100%"},onSelectionChange:x},{default:o(()=>[r(i,{type:"selection",width:"55","header-align":"center",align:"center"}),r(i,{prop:"studentName",label:"学生姓名"}),r(i,{prop:"orderNo",label:"订单号",width:"160px"}),r(i,{prop:"createTime",label:"下单时间",width:"180px"}),r(i,{prop:"payNo",label:"支付单号","show-overflow-tooltip":""}),r(i,{prop:"payType",label:"支付方式"},{default:o(e=>[e.row.payType==="支付宝"?(p(),c(_,{key:0,type:"info"},{default:o(()=>[n(m(e.row.payType),1)]),_:2},1024)):u("",!0),e.row.payType==="微信"?(p(),c(_,{key:1,type:"success"},{default:o(()=>[n(m(e.row.payType),1)]),_:2},1024)):u("",!0)]),_:1}),r(i,{prop:"price",label:"订单价格"},{default:o(e=>[y("span",Q,"￥"+m(e.row.price),1)]),_:1}),r(i,{prop:"status",label:"订单状态"},{default:o(e=>[e.row.status==="待支付"?(p(),c(_,{key:0,type:"warning"},{default:o(()=>[n(m(e.row.status),1)]),_:2},1024)):u("",!0),e.row.status==="已支付"?(p(),c(_,{key:1,type:"info"},{default:o(()=>[n(m(e.row.status),1)]),_:2},1024)):u("",!0),e.row.status==="已上餐"?(p(),c(_,{key:2,type:"primary"},{default:o(()=>[n(m(e.row.status),1)]),_:2},1024)):u("",!0),e.row.status==="已完成"?(p(),c(_,{key:3,type:"success"},{default:o(()=>[n(m(e.row.status),1)]),_:2},1024)):u("",!0)]),_:1}),r(i,{label:"订单详情"},{default:o(e=>[r(f,{type:"primary",plain:"",onClick:h=>E(e.row.id,e.row.status)},{default:o(()=>t[7]||(t[7]=[n("查看详情")])),_:2},1032,["onClick"])]),_:1}),r(i,{label:"操作",width:"180"},{default:o(e=>[e.row.status==="已支付"?(p(),c(f,{key:0,type:"success",plain:"",onClick:h=>D(e.row,"已上餐")},{default:o(()=>t[8]||(t[8]=[n("上餐")])),_:2},1032,["onClick"])):u("",!0),r(f,{type:"danger",plain:"",onClick:h=>V(e.row)},{default:o(()=>t[9]||(t[9]=[n("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),a.total?(p(),N("div",W,[r(T,{onCurrentChange:g,background:"",layout:"total, prev, pager, next","page-size":a.pageSize,"current-page":a.pageNum,"onUpdate:currentPage":t[2]||(t[2]=e=>a.pageNum=e),total:a.total},null,8,["page-size","current-page","total"])])):u("",!0),r(z,{title:"订单详情",modelValue:a.itemVisible,"onUpdate:modelValue":t[3]||(t[3]=e=>a.itemVisible=e),width:"60%"},{default:o(()=>[r(b,{stripe:"",data:a.ordersItemData,border:"",style:{width:"100%"}},{default:o(()=>[r(i,{prop:"dish.name",label:"菜品名称"}),r(i,{prop:"dish.img",label:"菜品图片",width:"90px"},{default:o(e=>[e.row.dish.img?(p(),c(B,{key:0,src:e.row.dish.img,"preview-src-list":[e.row.dish.img],fit:"cover",style:{width:"50px",height:"50px","object-fit":"cover"},"preview-teleported":""},{error:o(()=>[y("div",X,[r(I,null,{default:o(()=>[r(A(J))]),_:1})])]),_:2},1032,["src","preview-src-list"])):u("",!0)]),_:1}),r(i,{prop:"dish.price",label:"菜品价格"},{default:o(e=>[y("span",Y,"￥ "+m(e.row.dish.price),1)]),_:1}),r(i,{prop:"num",label:"菜品份数"},{default:o(e=>[n(" x"+m(e.row.num),1)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}};export{ge as default};
