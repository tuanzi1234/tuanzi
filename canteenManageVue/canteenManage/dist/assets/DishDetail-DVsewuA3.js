/* empty css                *//* empty css               *//* empty css                *//* empty css                  *//* empty css              *//* empty css                     *//* empty css             *//* empty css               *//* empty css            */import{r as c}from"./request-D4_zAD7W.js";import{r as C,h as b,c as a,a as o,t as i,g as p,b as d,w as m,v as T,N as z,O as B,E as n,R as L,z as S,C as U,o as r,$ as P,a4 as G,J as O,L as R}from"./index-CnZojLtj.js";const j="/assets/%E7%82%B9%E8%B5%9E(1)-B5pvTRzF.svg",A="/assets/%E7%82%B9%E8%B5%9E-CQNUuV6N.svg",F="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1742531127938'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='5654'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M490.304%2083.84a64%2064%200%200%201%2085.312%2030.208l96.448%20202.56%20222.144%2028.992a64%2064%200%200%201%2030.656%2012.672l6.336%205.504a64%2064%200%200%201%200%2090.56l-160.384%20160.32%2038.784%20222.976a64%2064%200%200%201-3.136%2033.408l-3.52%207.808a64%2064%200%200%201-86.656%2026.112L518.144%20798.72l-204.736%20107.264a64%2064%200%200%201-32.32%207.232l-8.32-0.896a64%2064%200%200%201-52.096-73.984l38.848-223.616L99.2%20454.336a64%2064%200%200%201-16.576-28.736l-1.6-8.32a64%2064%200%200%201%2055.168-71.68l222.528-29.056%20101.888-203.584a64%2064%200%200%201%2022.272-24.96l7.424-4.224z%20m27.264%2086.912l-99.2%20198.4-9.152%2018.304-20.224%202.624-217.152%2028.288%20156.16%20156.096%2014.08%2014.08-3.456%2019.648-37.888%20217.664%20199.872-104.64%2017.984-9.472%2017.92%209.6%20192.96%20103.488-37.76-216.64-3.328-19.648%2014.08-14.08%20156.032-156.096-217.088-28.288-20.672-2.688-8.96-18.88-94.208-197.76z'%20p-id='5655'%20fill='%231296db'%3e%3c/path%3e%3c/svg%3e",M="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1742531145226'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='6030'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M512%20179.541333l81.3056%20164.727467a102.4%20102.4%200%200%200%2077.141333%2056.046933l181.794134%2026.4192-131.584%20128.238934a102.4%20102.4%200%200%200-29.422934%2090.624l31.061334%20181.111466-162.645334-85.504a102.4%20102.4%200%200%200-95.300266%200L301.704533%20826.709333l31.061334-181.111466a102.4%20102.4%200%200%200-29.422934-90.624l-131.584-128.238934%20181.828267-26.4192a102.4%20102.4%200%200%200%2077.1072-56.046933L512%20179.541333z%20m30.6176-92.2624a34.133333%2034.133333%200%200%200-61.2352%200l-111.9232%20226.781867a34.133333%2034.133333%200%200%201-25.7024%2018.670933L93.525333%20369.117867a34.133333%2034.133333%200%200%200-18.909866%2058.231466l181.111466%20176.503467a34.133333%2034.133333%200%200%201%209.796267%2030.208L222.754133%20883.370667a34.133333%2034.133333%200%200%200%2049.493334%2035.976533l223.880533-117.691733a34.133333%2034.133333%200%200%201%2031.744%200l223.8464%20117.691733a34.133333%2034.133333%200%200%200%2049.527467-35.976533l-42.734934-249.275734a34.133333%2034.133333%200%200%201%209.796267-30.208l181.111467-176.503466a34.133333%2034.133333%200%200%200-18.909867-58.231467l-250.2656-36.386133a34.133333%2034.133333%200%200%201-25.7024-18.670934l-111.957333-226.781866z'%20fill='%23202425'%20p-id='6031'%3e%3c/path%3e%3c/svg%3e",q={style:{width:"60%",margin:"20px auto","min-height":"800px"}},H={style:{display:"flex","grid-gap":"15px"}},J={class:"card",style:{flex:"1",display:"flex","align-items":"center"}},W=["src"],Y={class:"card",style:{flex:"1",padding:"10px 20px"}},$={style:{"font-size":"25px"}},Q={style:{"margin-top":"10px"}},K={style:{color:"red"}},X={style:{"font-size":"25px"}},Z={style:{"margin-left":"10px"}},e0={style:{"margin-top":"10px"}},t0={style:{"margin-top":"15px","line-height":"25px","text-align":"justify"},class:"line4"},s0={key:0,style:{"margin-top":"20px",display:"flex","align-items":"center","justify-content":"center"}},o0={key:2,style:{"margin-left":"5px","font-size":"20px",color:"#d81e06"}},i0={key:3,style:{"margin-left":"5px","font-size":"20px"}},l0={key:6,style:{"margin-left":"5px","font-size":"20px",color:"#0449a5"}},a0={key:7,style:{"margin-left":"5px","font-size":"20px"}},r0={style:{"margin-top":"20px","text-align":"center"}},d0={class:"card",style:{"margin-top":"10px"}},n0={style:{"font-size":"20px",height:"40px","line-height":"40px","border-bottom":"1px solid #cccccc"}},c0=["src"],m0={style:{width:"100px"}},p0={style:{flex:"1"}},h0={style:{color:"#828282","line-height":"20px"}},g0={style:{width:"150px",color:"#828282"}},u0={class:"dialog-footer"},T0={__name:"DishDetail",setup(f0){const e=C({user:JSON.parse(localStorage.getItem("project-user")||"{}"),dishId:b.currentRoute.value.query.id,dishData:{},praiseNum:0,isPraise:!1,collectNum:0,isCollect:!1,form:{},formVisible:!1,ordersItemData:[]}),u=()=>{c.get("/dish/selectById/"+e.dishId).then(t=>{t.code==="200"?e.dishData=t.data:n.error(t.msg)})};u(),(()=>{!e.user||!e.user.name||c.post("/history/add",{dishId:e.dishId}).then(t=>{t.code!=="200"&&n.error(t.msg)})})();const f=()=>{c.post("/praise/add",{dishId:e.dishId}).then(t=>{t.code==="200"?_():n.error(t.msg)})},_=()=>{c.get("/praise/selectAll",{params:{dishId:e.dishId}}).then(t=>{if(t.code==="200"){if(e.praiseNum=t.data.length,e.user.role==="STUDENT"){let s=t.data.filter(h=>h.studentId===e.user.id);s&&s.length?e.isPraise=!0:e.isPraise=!1}}else n.error(t.msg)})};_();const x=()=>{c.post("/collect/add",{dishId:e.dishId}).then(t=>{t.code==="200"?y():n.error(t.msg)})},y=()=>{c.get("/collect/selectAll",{params:{dishId:e.dishId}}).then(t=>{if(t.code==="200"){if(e.collectNum=t.data.length,e.user.role==="STUDENT"){let s=t.data.filter(h=>h.studentId===e.user.id);s&&s.length?e.isCollect=!0:e.isCollect=!1}}else n.error(t.msg)})};y();const v=()=>{e.form.dishId=e.dishId,e.form.studentId=e.user.id,e.form.num=1,e.formVisible=!0},w=()=>{c.post("/dishItem/add",e.form).then(t=>{t.code==="200"?(n.success("点单成功"),e.formVisible=!1,u()):n.error(t.msg)})};return(()=>{c.get("/ordersItem/selectAll",{params:{dishId:e.dishId}}).then(t=>{t.code==="200"?e.ordersItemData=t.data.filter(s=>s.comment||s.score):n.error(t.msg)})})(),(t,s)=>{const h=L,g=S,I=P,D=G,N=O,V=R,k=U;return r(),a("div",q,[o("div",H,[o("div",J,[o("img",{src:e.dishData.img,alt:"",style:{width:"100%",height:"300px","border-radius":"5px"}},null,8,W)]),o("div",Y,[o("div",$,i(e.dishData.name),1),o("div",Q,[o("strong",K,[o("span",X,"￥"+i(e.dishData.price),1),s[3]||(s[3]=p(" / 份"))]),o("span",Z,"剩余："+i(e.dishData.num)+"份",1)]),o("div",e0,[s[4]||(s[4]=p("所属分类：")),d(h,{type:"success"},{default:m(()=>[p(i(e.dishData.categoryName),1)]),_:1})]),o("div",t0,"菜品描述："+i(e.dishData.content),1),e.user.role==="STUDENT"?(r(),a("div",s0,[e.isPraise?(r(),a("img",{key:0,onClick:f,src:j,alt:"",style:{width:"25px",height:"25px",cursor:"pointer"}})):(r(),a("img",{key:1,onClick:f,src:A,alt:"",style:{width:"25px",height:"25px",cursor:"pointer"}})),e.isPraise?(r(),a("div",o0,i(e.praiseNum),1)):(r(),a("div",i0,i(e.praiseNum),1)),e.isCollect?(r(),a("img",{key:4,onClick:x,src:F,alt:"",style:{width:"30px",height:"30px",cursor:"pointer","margin-left":"40px"}})):(r(),a("img",{key:5,onClick:x,src:M,alt:"",style:{width:"30px",height:"30px",cursor:"pointer","margin-left":"40px"}})),e.isCollect?(r(),a("div",l0,i(e.collectNum),1)):(r(),a("div",a0,i(e.collectNum),1))])):T("",!0),o("div",r0,[d(g,{onClick:v,type:"info",disabled:e.user.role===t.STUDENT,style:{padding:"20px 30px","font-size":"15px"}},{default:m(()=>s[5]||(s[5]=[p("我想吃")])),_:1},8,["disabled"])])])]),o("div",d0,[o("div",n0,"菜品评价（"+i(e.ordersItemData.length)+"）",1),(r(!0),a(z,null,B(e.ordersItemData,l=>(r(),a("div",{key:l.id,style:{"margin-top":"20px",display:"flex","grid-gap":"20px","align-items":"center"}},[o("img",{src:l.studentAvatar,alt:"",style:{width:"50px",height:"50px","border-radius":"50%","object-fit":"cover"}},null,8,c0),o("div",m0,i(l.studentName),1),o("div",p0,[d(I,{modelValue:l.score,"onUpdate:modelValue":E=>l.score=E,disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value} 分"},null,8,["modelValue","onUpdate:modelValue"]),o("div",h0,i(l.comment),1)]),o("div",g0,i(l.time),1)]))),128))]),d(k,{title:"选择点单数量",modelValue:e.formVisible,"onUpdate:modelValue":s[2]||(s[2]=l=>e.formVisible=l),width:"30%"},{footer:m(()=>[o("div",u0,[d(g,{onClick:s[1]||(s[1]=l=>e.formVisible=!1)},{default:m(()=>s[6]||(s[6]=[p("取消")])),_:1}),d(g,{type:"primary",onClick:w},{default:m(()=>s[7]||(s[7]=[p(" 确定 ")])),_:1})])]),default:m(()=>[d(V,{ref:"formRef",rules:e.rules,model:e.form,"label-width":"80px",style:{padding:"20px"}},{default:m(()=>[d(N,{prop:"num",label:"份数"},{default:m(()=>[d(D,{modelValue:e.form.num,"onUpdate:modelValue":s[0]||(s[0]=l=>e.form.num=l),min:1,max:e.dishData.num},null,8,["modelValue","max"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])])}}};export{T0 as default};
